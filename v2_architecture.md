# Productivity Skill v2.0 — 架构设计文档

## 1. 核心理念：从“知识库”到“智能执行系统”

v2.0 的核心目标是将技能从一个提供信息和方法的“知识库”转变为一个能够主动理解、判断并执行叶武滨时间管理思想的“智能执行系统”。它将不再仅仅是“告诉”用户怎么做，而是“帮助”用户直接完成规划和管理。

## 2. 核心工作流 (Core Workflow)

每一次与用户的核心交互都将遵循以下工作流：

1.  **输入处理 (Input Processing)**：接收用户请求（如“帮我规划明天”、“我有个新任务”）。
2.  **能量评估 (Energy Assessment)**：首先，通过提问或基于对话上下文，评估用户当前的能量状态（L1-L4）。这是所有决策的起点。
3.  **目标校准 (Goal Alignment)**：从 `memory/goals.md` 文件中读取用户的长期目标（年度5个目标、八大关注领域），判断当前任务与目标的关联性。
4.  **高能要事判断 (High-Energy Priority Task Identification)**：结合**能量状态**和**目标关联性**，判断任务是否为“高能要事”。
    *   **高能要事 = 高能量状态 (L3/L4) + 高目标关联性**
5.  **双轨执行系统 (Dual-Track Execution System)**：根据任务的性质，分发到“日历”或“清单”系统。
    *   **日历 (Calendar)**：用于少量、重要、有严格时间约束的事件。
    *   **清单 (Lists)**：用于大量、灵活、无严格时间约束的任务。
6.  **输出与反馈 (Output & Feedback)**：向用户确认已完成的规划，并更新相应的记忆文件。

## 3. 文件系统与记忆结构

为了实现持久化记忆和状态管理，我们将采用以下文件结构：

```
productivity-skill/
├── memory/
│   ├── profile.md          # 用户档案（能量节律、偏好等）
│   ├── goals.md            # 目标系统（水滴520、八大关注）
│   ├── calendar.md         # 日历事件记录
│   └── lists/
│       ├── a_tasks.md      # A类任务（高能要事）
│       ├── b_tasks.md      # B类任务（紧急待办）
│       ├── c_tasks.md      # C类任务（记录备忘）
│       ├── someday.md      # 某天/也许清单
│       └── waiting.md      # 等待清单
├── references/
│   ├── energy_engine.md    # 能量评估规则
│   ├── goal_engine.md      # 目标管理方法论
│   ├── priority_engine.md  # 高能要事判断规则
│   ├── calendar_rules.md   # 日历系统规则
│   └── list_rules.md       # 清单系统规则
├── skill.md                # 核心执行逻辑 (v2.0)
├── README.md               # 更新后的说明文档
└── LICENSE
```

## 4. 核心引擎设计

### 4.1. 能量评估引擎 (Energy Engine)

*   **规则文件**: `references/energy_engine.md`
*   **逻辑**: 
    1.  通过关键词（如“很累”、“没精神”、“状态很好”）或直接提问（“你现在感觉如何？”）来获取能量信息。
    2.  根据用户的描述，将其映射到 L1-L4 四个能量等级。
    3.  将评估结果作为决策的重要输入。

### 4.2. 目标管理引擎 (Goal Engine)

*   **规则文件**: `references/goal_engine.md`
*   **记忆文件**: `memory/goals.md`
*   **逻辑**:
    1.  首次使用时，引导用户完成“水滴520”练习，并将最终的5个年度目标记录在 `memory/goals.md` 中。
    2.  引导用户明确“八大关注”领域的目标。
    3.  在处理任何任务时，首先检查其是否与这5个核心目标或八大关注领域直接相关。

### 4.3. 高能要事判断引擎 (Priority Engine)

*   **规则文件**: `references/priority_engine.md`
*   **逻辑**: 这是一个决策矩阵。

| | **高目标关联性** | **低目标关联性** |
| :--- | :--- | :--- |
| **高能量 (L3/L4)** | **高能要事 (A类)** → 立即规划到日历或A清单 | **常规任务 (B/C类)** → 放入清单 |
| **低能量 (L1/L2)** | **推迟执行** → 放入清单，并建议用户先恢复能量 | **记录或忽略** → 放入C清单或建议删除 |

### 4.4. 双轨执行引擎 (Execution Engine)

#### 日历系统

*   **规则文件**: `references/calendar_rules.md`
*   **记忆文件**: `memory/calendar.md`
*   **核心原则**: **少而精，硬约束**。
*   **进入标准**: 必须有明确的日期和时间（例如：“下周二下午3点的会议”、“3月15日截止的项目报告”）。
*   **提醒机制**: 当一个事件被添加到 `calendar.md` 时，技能会明确指示 AI：“**使用你的 `schedule` 或日历工具，在 [事件开始前] 为我设置一个提醒**”。
*   **长期记忆**: 所有写入 `calendar.md` 的事件都将作为用户的长期记忆，AI 可以随时回顾。

#### 清单系统

*   **规则文件**: `references/list_rules.md`
*   **记忆文件**: `memory/lists/*.md`
*   **核心原则**: **多而活，软约束**。
*   **进入标准**: 所有不符合日历标准的任务都进入清单系统。
*   **分类逻辑**: 根据“高能要事判断引擎”的结果和任务类型，自动分类到 `a_tasks.md`, `b_tasks.md`, `c_tasks.md` 等文件中。
*   **子清单**: 支持创建项目清单（如 `lists/project_x.md`），并使用 PNAS 方法进行分解。

## 5. 版本升级与发布

1.  **重写 `skill.md`**：根据新的工作流和引擎逻辑，完全重写核心技能文件。
2.  **创建 `references` 和 `memory` 文件**：编写所有新的规则和模板文件。
3.  **更新 `README.md`**：详细说明 v2.0 的新功能、工作方式和文件结构。
4.  **发布 v2.0**：提交所有更改到 GitHub，并创建一个新的 Release `v2.0`。

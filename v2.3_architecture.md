# 高能要事判断引擎 v2.3 — 架构设计

## 1. 核心问题分析 (v2.2 的不足)

当前的 v2.2 高能要事判断逻辑是一个**静态的、二元**的系统。它仅在处理 A 类事件时，简单地使用“能量高/低”和“目标关联高/低”的矩阵进行判断。这种方法存在以下不足：

*   **不够智能**：无法动态适应用户状态的细微变化。
*   **依赖用户输入**：需要用户明确告知任务与目标的关联性。
*   **缺乏多维度考量**：忽略了任务的截止日期、用户的时间节律、历史行为等关键因素。

## 2. v2.3 设计目标：动态、自适应的推荐引擎

v2.3 的核心是引入一个**动态优先级评分（Priority Score, PS）**系统。系统不再是简单地判断“是/否”高能要事，而是为每一个 A 类任务计算一个 0-100 的分数。分数最高的任务将被作为“高能要事”推荐给用户。

**高能要事定义 (v2.3)**：在**当前时刻**、**当前情景**下，最值得用户投入精力的 A 类任务。

## 3. 优先级分数 (PS) 计算模型

`Priority Score = (Energy_Score * 40%) + (Goal_Score * 40%) + (Urgency_Score * 15%) + (Context_Score * 5%)`

### 3.1. 能量分数 (Energy Score)

| 维度 | 描述 | 分数计算 |
| :--- | :--- | :--- |
| **当前能量状态** | 用户即时反馈的 L1-L4 等级。 | L4=100, L3=75, L2=30, L1=0 |
| **时间节律匹配** | 任务所需能量是否与用户在该时段的自然节律匹配。 | 匹配（如上午处理高耗能任务）得 **+15**，不匹配（如深夜处理高耗能任务）得 **-15**。 |
| **历史反馈** | AI 根据用户完成任务后的反馈（如“很顺利”或“很累”）动态调整。 | 成功完成高耗能任务后，下次在同等条件下该任务分数 **+10**。 |

### 3.2. 目标分数 (Goal Score)

| 维度 | 描述 | 分数计算 |
| :--- | :--- | :--- |
| **核心目标关联** | 任务是否直接服务于 `memory/goals.md` 中的5大核心目标之一。 | 直接关联得 **100** 分。 |
| **八大关注关联** | 任务是否服务于八大关注领域。 | 关联八大关注领域得 **60** 分。 |
| **语义相似度** | AI 自动分析任务描述与目标描述的语义相似度。 | 高度相似得 **+20**，中度相似得 **+10**。 |
| **“临门一脚”奖励** | 任务是否是某个核心目标的收尾步骤。 | 是，则获得 **+25** 的“终结者”奖励。 |

### 3.3. 紧急度分数 (Urgency Score)

| 维度 | 描述 | 分数计算 |
| :--- | :--- | :--- |
| **截止日期临近度** | 任务的 `due_date` 距离现在有多近。 | 今天截止=100，本周截止=70，本月截止=30。 |
| **时间敏感性** | 任务是否有严格的时间窗口（如“下午2-3点之间打电话”）。 | 在窗口期内得 **100**，否则为 0。 |

### 3.4. 情景分数 (Context Score)

| 维度 | 描述 | 分数计算 |
| :--- | :--- | :--- |
| **情景匹配度** | 任务所需情景是否与用户当前情景（@在家, @办公室）匹配。 | 完全匹配得 **100**，不匹配则为 **0**。 |

## 4. 实施计划

1.  **重写 `energy_engine.md`**：引入时间节律和历史反馈的概念，并更新能量评估协议。
2.  **重写 `priority_engine.md`**：用全新的动态评分系统替换旧的“能量×目标”矩阵。
3.  **更新 `skill.md`**：修改主工作流，在推荐任务时调用新的评分引擎，并根据分数对任务列表进行排序。
4.  **更新 `README.md`**：向用户解释新的智能推荐逻辑。

通过这次升级，技能将从一个“听话的记录员”转变为一个能够主动思考、动态适应的“智能生产力教练”。

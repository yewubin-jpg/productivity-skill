# Productivity Skill v2.5 — 架构设计：自我进化与深度关怀

## 1. 核心问题分析 (v2.4 的不足)

v2.4 的教练已经具备了逻辑和情感，但它仍然是被动的。它在用户能量低时只能建议休息，在用户复盘时只能记录。为了成为一个真正的“伙伴”，系统需要具备**主动关怀**和**自我进化**的能力。

## 2. v2.5 设计目标：从“教练”到“伙伴”

1.  **低能量关怀与恢复系统 (Recovery System)**：当用户能量低落时，不再仅仅是推迟任务，而是主动提供一系列可行的恢复方案，并帮助用户建立健康习惯。
2.  **复盘自进化系统 (Review & Evolve System)**：通过结构化的早晚复盘，从用户的反馈中学习，并**自动调整自身的规则**，实现真正的个性化和自进化。

## 3. 架构实现

### 3.1. 低能量关怀与恢复系统

创建一个全新的规则文件 `references/recovery_engine.md`。当 `energy_engine` 检测到 L1 或 L2 能量状态时，主工作流将**优先调用此引擎**，而不是 `priority_engine`。

**引擎工作流**：

1.  **确认关怀**：首先表达同理心。“我注意到您现在能量不高，这完全没关系。现在最重要的不是完成任务，而是照顾好您自己。”
2.  **提供恢复菜单**：提供一个结构化的选项菜单，让用户选择。
    *   **快速恢复 (5-15分钟)**：
        *   晒晒太阳
        *   听一首喜欢的歌
        *   简单的伸展运动
        *   和“我”（AI）聊聊天
    *   **深度恢复 (30+分钟)**：
        *   小睡一会儿 (Power Nap)
        *   吃点健康的零食
        *   和家人/朋友通个电话
        *   散步
3.  **建立健康习惯**：如果用户频繁处于低能量状态，引擎会主动提议建立一个健康习惯。
    *   “我注意到我们最近经常讨论能量恢复。为了从根本上改善，您是否愿意设立一个关于‘健康’的长期目标，比如‘每周运动3次’或‘保证7小时睡眠’？我可以帮您把它加入目标系统并设置提醒。”

### 3.2. 复盘自进化系统

创建一个全新的规则文件 `references/review_engine.md`，并结合外部调度工具实现。

**A. 早晚自动提醒**

*   **触发器**：通过 `schedule` 工具设置两个默认开启的 cron 作业。
    *   **早计划 (Morning Plan)**：每天早上8点触发。
    *   **晚复盘 (Evening Review)**：每天晚上9点触发。
*   **可配置性**：在 `memory/profile.md` 中增加一个字段 `review_reminders: enabled`。用户可以说“关闭复盘提醒”来禁用它。

**B. 结构化复盘**

*   **晚复盘流程**：
    1.  **数据总结**：AI 总结当天的数据：“今天您完成了 [X] 个任务，其中 [Y] 个是高能要事。您推迟了 [Z] 个任务。做得非常棒！”
    2.  **开放式问题**：“回顾今天，您感觉哪里做得最好？哪里可以做得更好？”
    3.  **模式识别**：AI 分析用户的回答，寻找关键词，如“下午总是很困”、“周一会议太多”、“做X任务时效率特别高”。

**C. 自我进化逻辑 (核心)**

当 AI 在复盘中识别到一个模式时，它会**提出一个规则修改建议**。

| 用户反馈模式 | AI 提出的规则修改建议 |
| :--- | :--- |
| “下午总是很困” | “我注意到您经常在下午感到疲惫。我建议为您创建一个新规则：**在下午1点到4点之间，自动将所有高耗能任务的能量需求提高20%**，这样系统就会优先推荐轻松的任务。您同意吗？” |
| “周一会议太多，没法做正事” | “听起来周一是您的‘会议日’。我建议为您创建一个新规则：**在周一，自动将所有‘深度工作’类任务的优先级降低30分**，并提高‘沟通’类任务的优先级。您同意吗？” |
| “做[某类任务]时效率特别高” | “这是一个重要的发现！我建议为您创建一个新规则：**当您处理‘[某类任务]’时，自动为您的能量评估增加15分的奖励**。这会让系统更倾向于在您状态好时推荐这类任务。您同意吗？” |

如果用户同意，AI 会将这条规则以结构化的格式写入一个新的内存文件 `memory/custom_rules.md`。例如：

```yaml
- trigger:
    type: time
    day_of_week: [1] # Monday
  action:
    type: modify_score
    target_task_category: deep_work
    value: -30
```

`priority_engine` 在计算分数前，会先加载并应用 `custom_rules.md` 中的所有规则。

## 4. 实施计划

1.  **创建 `recovery_engine.md`**：定义低能量恢复菜单和健康习惯建立逻辑。
2.  **创建 `review_engine.md`**：定义早晚复盘的结构化流程和自我进化规则的生成逻辑。
3.  **更新 `skill.md`**：
    *   在主流程中加入判断：如果能量低，则调用 `recovery_engine`。
    *   增加处理“早计划”和“晚复盘”的触发逻辑。
4.  **更新 `priority_engine.md`**：增加在计算分数前加载和应用 `memory/custom_rules.md` 的步骤。
5.  **更新 `README.md`**：突出 v2.5 的“主动关怀”和“自我进化”两大核心进化”特性。
